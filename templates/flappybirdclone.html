<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Flappy Bird Clone</title>
  <style>
        * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    }

    body {
    background: skyblue;
    font-family: sans-serif;
    overflow: hidden;
    }

    body::before {
    content: "";
    position: fixed;
    z-index: -2;
    width: 200%;
    height: 100%;
    background: url('https://i.ibb.co/w0X7L4d/bg-day.png') repeat-x;
    background-size: cover;
    animation: bgScroll 10s linear infinite;
    }

    @keyframes bgScroll {
    from { transform: translateX(0); }
    to { transform: translateX(-50%); }
    }

    .game-container {
    position: relative;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
    }

    .bird {
    position: absolute;
    top: 200px;
    left: 20%;
    width: 40px;
    height: 40px;
    background: yellow;
    border-radius: 50%;
    }

    .pipe {
    position: absolute;
    width: 60px;
    background: green;
    }

    .pipe-top {
    top: 0;
    border-bottom: 6px solid #006400;
    }

    .pipe-bottom {
    bottom: 0;
    border-top: 6px solid #006400;
    }

    .ground {
    position: absolute;
    bottom: 0;
    width: 200%;
    height: 100px;
    background: green;
    background-size: contain;
    animation: groundMove 2s linear infinite;
    }

    @keyframes groundMove {
    from { transform: translateX(0); }
    to { transform: translateX(-50%); }
    }

    .score {
    position: absolute;
    top: 20px;
    left: 20px;
    font-size: 24px;
    color: #333;
    font-weight: bold;
    z-index: 2;
    }

    .game-over {
    display: none;
    position: absolute;
    top: 40%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(255,255,255,0.9);
    padding: 30px 50px;
    border-radius: 10px;
    text-align: center;
    font-size: 20px;
    box-shadow: 0 0 10px #00000040;
    z-index: 3;
    }

    .game-over button {
    margin-top: 15px;
    padding: 10px 20px;
    font-size: 16px;
    background: #ffcc00;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="game-container">
    <div class="bird"></div>
    <div class="score">Score: 0</div>
    <div class="ground"></div>
  </div>

  <div class="game-over">
    <h1>Game Over</h1>
    <p>Your Score: <span id="final-score">0</span></p>
    <button onclick="location.reload()">Restart</button>
    <button onclick="window.location.href='/romantic'">Back to Home</button>
  </div>

  <script>
    const username = "{{ username }}"; 
    const gameName = "Flappy Bird Clone";
    const bird = document.querySelector(".bird");
    const gameContainer = document.querySelector(".game-container");
    const scoreDisplay = document.querySelector(".score");
    
    let birdTop = 200;
    let birdVelocity = 0;
    let gravity = 0.3; // Slower fall initially
    let isGameOver = false;
    let score = 0;
    let gap = 160;
    let pipeSpeed = 2; // Starts slower
    let pipeFrequency = 2000; // Pipes appear every 2 seconds

    document.addEventListener("keydown", flap);
    document.addEventListener("click", flap);

function flap() {
  if (isGameOver) return;
  birdVelocity = -7;
}

function startGame() {
  setInterval(updateBird, 20);
  setInterval(() => {
    if (!isGameOver) createPipe();
  }, pipeFrequency);

  // Gradually increase difficulty
  setInterval(() => {
    if (pipeSpeed < 6) pipeSpeed += 0.2;
    if (gap > 100) gap -= 5;
    if (pipeFrequency > 1000) pipeFrequency -= 50;
  }, 5000); // Every 5 seconds
}

function updateBird() {
  if (isGameOver) return;
  birdVelocity += gravity;
  birdTop += birdVelocity;

  bird.style.top = birdTop + "px";
  bird.style.transform = `rotate(${Math.min(birdVelocity * 3, 90)}deg)`;

  if (birdTop >= window.innerHeight - 140 || birdTop <= 0) {
    gameOver();
  }
}

function createPipe(startLeft = window.innerWidth) {
  if (isGameOver) return;

  const minPipeHeight = 50;
  const maxPipeHeight = window.innerHeight - gap - 200;
  const pipeTopHeight = Math.floor(Math.random() * (maxPipeHeight - minPipeHeight) + minPipeHeight);
  const pipeBottomHeight = window.innerHeight - pipeTopHeight - gap;
  let pipeLeft = startLeft;

  const pipeTop = document.createElement("div");
  const pipeBottom = document.createElement("div");

  pipeTop.classList.add("pipe", "pipe-top");
  pipeBottom.classList.add("pipe", "pipe-bottom");

  pipeTop.style.height = pipeTopHeight + "px";
  pipeBottom.style.height = pipeBottomHeight + "px";
  pipeTop.style.left = pipeBottom.style.left = pipeLeft + "px";

  gameContainer.appendChild(pipeTop);
  gameContainer.appendChild(pipeBottom);

  let passed = false;

  let movePipe = setInterval(() => {
    if (isGameOver) return clearInterval(movePipe);

    pipeLeft -= pipeSpeed;
    pipeTop.style.left = pipeLeft + "px";
    pipeBottom.style.left = pipeLeft + "px";

    if (!passed && pipeLeft + 60 < parseInt(getComputedStyle(bird).left)) {
      passed = true;
      score++;
      document.getElementById("pointSound").play();
      scoreDisplay.innerText = "Score: " + score;
    }

    if (pipeLeft < -60) {
      clearInterval(movePipe);
      pipeTop.remove();
      pipeBottom.remove();
    }

    const birdBox = bird.getBoundingClientRect();
    const topBox = pipeTop.getBoundingClientRect();
    const bottomBox = pipeBottom.getBoundingClientRect();

    const buffer = 5;

  if (
    birdBox.right - buffer > topBox.left &&
    birdBox.left + buffer < topBox.right &&
    (birdBox.top + buffer < topBox.bottom || birdBox.bottom - buffer > bottomBox.top)
  )
    {
      gameOver();
    }
  }, 20);
}
function sendScoreToBackend(username, gameName, score) {
    fetch('/update_score', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            username: username,
            game_name: gameName,
            score: score
        })
    })
    .then(res => res.json())
    .then(data => console.log("Score update:", data))
    .catch(err => console.error(err));
}
function gameOver() {
  isGameOver = true;
  document.querySelector(".game-over").style.display = "block";
  document.getElementById("final-score").innerText = score;
  let finalScore = score; 
  sendScoreToBackend(username, gameName,Â finalScore);
}
startGame();
  </script>
</body>
</html>